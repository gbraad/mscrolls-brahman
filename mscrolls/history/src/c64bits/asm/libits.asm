CKOUT	EQU	$FFC9
CLRCH	EQU	$FFCC
BSOUT	EQU	$FFD2
CIA	EQU	$DD00
DAT	EQU	CIA+1
DDR	EQU	CIA+3
ICR	EQU	CIA+13
BUFFER	EQU	$E00		;use sprite area for buffer

	ORG	$B00

RS_VECT	JMP	READSECT
WS_VECT	JMP	WRITESECT
IN_VECT	JMP	INIT

INIT	LDA	#0		;all lines to i/p
	STA	DDR
	RTS

READSECT
	LDX	#0
RS_LOOP
	JSR	GETBYTE
	STA	BUFFER,X
	INX
	BNE	RS_LOOP
	RTS

WRITESECT
	LDX	#5		;channel to disk drive
	JSR	CKOUT
	LDX	#0
WS_LOOP
	LDA	BUFFER,X
	JSR	BSOUT
	INX
	BNE	WS_LOOP
	JSR	CLRCH
	RTS

; get a byte from parallel port, with handshaking
GETBYTE
	LDA	ICR
	AND	#$10
	BEQ	GETBYTE
	LDA	DAT
	RTS
